type: "object"
title: "Elastigroup Wrapper"
required:
  - group
properties:
  group:
    type: "object"
    title: "Azure Elastigroup"
    required:
      - name
      - region
      - resourceGroupName
      - capacity
      - strategy
      - compute
    properties:
      id:
        type: "string"
        example: "sig-123456789"
        readOnly: true
        description: >
          Azure Elastigroup ID
      name:
        type: "string"
        example: "spotinst-group"
        description: >
          Azure Elastigroup Name
      region:
        type: "string"
        example: "eastus"
        description: >
          Valid Azure region the Elastigroup is managed in
      resourceGroupName:
        type: string
        example: spotinst-azure
        description: >
          The Azure resource group to associate the elastigroup with
      capacity:
        type: "object"
        properties:
          target:
            type: "integer"
            example: 8
            description:
              Current scale the elastigroup will conform to
          minimum:
            type: "integer"
            example: 2
            description: >
              The elastigroup will not set a target below this value
          maximum:
            type: "integer"
            example: 10
            description: >
              The elastigroup will not set a target greater than this value
      scaling:
        type: object
        title: Azure Scaling
        properties:
          up:
            type: array
            items:
              $ref: "../../scaleSetVms/schemas/scaling-policy-up.yaml"
          down:
            type: array
            items:
              $ref: "../../scaleSetVms/schemas/scaling-policy-down.yaml"
      strategy:
        type: "object"
        title: Scaling Strategy
        properties:
          spotPercentage:
            type: integer
            example: 50
          drainingTimeout:
            type: integer
            example: 30
          fallbackToOd:
            type: Boolean
            example: true
      compute:
        required:
          - vmSizes
          - os
          - launchSpecification
        type: "object"
        properties:
          vmSizes:
            type: "object"
            properties:
              odSizes:
                type: array
                items:
                  type: string
                  example: standard_a1_v1
              lowPrioritySizes:
                type: array
                items:
                  type: string
                  example: standard_a2_v2
          os:
            type: sting
            example: Linux
            enum:
              - Linux
              - Windows
          launchSpecification:
            type: object
            properties:
              image:
                type: object
                properties:
                  marketplace:
                    type: object
                    description:
                      Azure Marketplace VM Image. Cannot be used with `custom`
                    properties:
                      publisher:
                        type: string
                        example: "OpenLogic"
                      offer:
                        type: string
                        example: "CentOS"
                      sku:
                        type: string
                        example: "7.3"
                      version:
                        type: string
                        example: "7.3-1611"
                  shutdownScript:
                    type: string
                    example: "IyEvdXNyL2Jpbi9lbnYgYmFzaAoiR29vZGJ5ZSBvbGQgaW5zdGFuY2Ui"
                  custom:
                    type: object
                    description: >
                      Custom VM image.  Cannot be used with `marketplace`
                    properties:
                      resourceGroupName:
                        type: string
                        example: "spotinst-azure"
                      imageName:
                        type: string
                        example: "custom-image-name"
              loadBalancersConfig:
                type: object
                properties:
                  loadBalancers:
                    type: array
                    items:
                      anyOf:
                        - type: object
                          title: MULTAI_TARGET_SET
                          properties:
                            type:
                              type: string
                              example: MULTAI_TARGET_SET
                              enum:
                                - MULTAI_TARGET_SET
                            balancerId:
                              type: string
                              example: lb-1ee2e3q
                            targetSetId:
                              type: string
                              example: ts-3eq
                            autoWeight:
                              type: boolean
                              example: true
                        - type: object
                          title: APPLICATION_GATEWAY
                          properties:
                            type:
                              type: string
                              example: APPLICATION_GATEWAY
                              enum:
                                - APPLICATION_GATEWAY
                            resourceGroupName:
                              type: string
                              example: azureResourceGroup
                            applicationGatewayName:
                              type: string
                              example: appGateway
                            backendPoolName:
                              type: string
                              example: backendpool490822
              userData:
                type: string
              managedServiceIdentities:
                type: array
                items:
                  type: object
                  properties:
                    name: string
                    example: mySI2
                  resourceGroupName:
                    resourceGroupName: string
                    example: myResourceGroup
              tags:
                type: array
                items:
                  type: object
                  properties:
                    tagKey:
                      type: string
                      example: env
                    tagValue:
                      type: string
                      example: staging
              network:
                type: object
                properties:
                  virtualNetworkName:
                    type: string
                    example: vname
                  subnetName:
                    type: string
                    example: my-subnet-name
                  resourceGroupName:
                    type: string
                    example: subnetResourceGroup
                  assignPublicIp: true
                  additionalIpConfigurations:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: config1
                        privateIpAddressVersion:
                          type: string
                          example: IPv4
              extensions:
                type: array
                items:
                  type: object
                  properties:
                    autoUpgradeMinorVersion:
                      type: boolean
                      example: true
                    name:
                      type: string
                      example: "k8s-agentpool1-38611891-vmss-computeAksLinuxBilling"
                    protectedSettings:
                      type: string
                      example: null
                    publisher:
                      type: string
                      example: "Microsoft.AKS"
                    type:
                      type: string
                      example: "Compute.AKS-Engine.Linux.Billing"
                    typeHandlerVersion:
                      type: string
                      example: "1.0"
              customData:
                type: string
              login:
                type: object
                properties:
                  userName:
                    type: string
                    example: spotinst
                  sshPublicKey:
                    type: string
                  password:
                    type: string
      health:
        type: object
        properties:
          autoHealing:
            type: boolean
            example: true
          healthCheckType:
            type: string
            example: INSTANCE_STATE
            enum:
              - INSTANCE_STATE
          gracePeriod:
            type: integer
            example: 120