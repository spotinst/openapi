type: object
title: "Stateful Node Compute"
description: |
  Defines the Computational parameters to use when launch the VM for the Stateful Node.
required:
  - os
  - vmSizes
  - launchSpecification
properties:
  os:
    type: string
    enum: [ Linux, Windows ]
    description: |
      Defines the correct operating system for which to launch the VM.
    example: "Linux"
  vmSizes:
    type: object
    description: |
      Defines the Vm Sizes to use when launching VMs.
    required:
      - odSizes
      - spotSizes
    properties:
      odSizes:
        type: array
        description: |
          Defines the On-Demand sizes to use when launching VMs.
        items:
          type: string
          example: "standard_a1_v1"
      spotSizes:
        type: array
        description: |
          Defines the Spot sizes to use when launching VMs.
        items:
          type: string
          example: "standard_a2_v2"
      preferredSpotSizes:
        type: array
        description: |
          Prioritize Spot VM sizes when launching Spot VMs.
          <a style=color:red>If set, must be a sublist of compute.vmSizes.spotSizes. </a>
        items:
          type: string
          example: "standard_a2_v2"
  zones:
    type: array
    description: |
      List of Azure Availability Zones in the defined region.
      * If not defined, VMs will be launched regionally.
    items:
      enum: [ 1, 2, 3 ]
      type: string
      example: 1
  preferredZones:
    type: array
    description: |
      The AZs to prioritize when launching VMs.
      * If no markets are available in the Preferred AZs, VMs are launched in the non-preferred AZs.
      * <a style=color:red>Must be a sublist of compute.zones.</a>
    items:
      enum: [ 1, 2, 3 ]
      type: string
      example: 1
  launchSpecification:
    type: object
    description: Defines the launch specification of the VM.
    required:
      - image
      - network
    properties:
      image:
        type: object
        description: |
          Defines the image to launch the VM.
          * <a style=color:red>Must be only one initialized from the following (marketplace, custom, gallery).</a>
        properties:
          marketplace:
            type: object
            description: |
              Select an image from Azure's Marketplace image catalogue.
              * <a style=color:red>Required if the custom image or gallery image are not specified.</a>
            required:
              - publisher
              - offer
              - sku
              - version
            properties:
              publisher:
                type: string
                description: |
                  Image publisher.
                example: "OpenLogic"
              offer:
                type: string
                description: |
                  Image offer.
                example: "CentOS"
              sku:
                type: string
                description: |
                  Image Stock Keeping Unit, which is the specific version of the image.
                example: "7.3"
              version:
                type: string
                description: |
                  Image's version. if version not provided we use "latest"
                default: "lastest"
                example: "7.3-1611"
          custom:
            type: object
            description: |
              Custom image definitions.
              * <a style=color:red>Required if marketplace image or gallery image are not specified.</a>
            required:
              - resourceGroupName
              - name
            properties:
              resourceGroupName:
                type: string
                description: |
                  The resource group name for custom image.
                example: "spotinst-azure"
              name:
                type: string
                description: |
                  The name of the custom image.
                example: "custom-image-name"
          gallery:
            title: Gallery
            type: object
            description: |
              Gallery image definitions.
              * <a style=color:red>Required if custom image or marketplace image are not specified.</a>
            required:
              - resourceGroupName
              - galleryName
              - imageName
              - versionName
            properties:
              resourceGroupName:
                title: Resource Group Name
                description: |
                  The resource group name for gallery image.
                type: string
                example: "spotinst-azure"
              galleryName:
                title: Gallery Name
                description: |
                  Name of the gallery.
                type: string
                example: "gallery-name"
              imageName:
                title: Image Name
                description: |
                  Name of the gallery image.
                type: string
                example: "gallery-image-name"
              versionName:
                title: Version
                description: |
                  Image's version. Can be in the format x.x.x or 'latest'.
                type: string
                example: "0.0.1"
      customData:
        type: string
        format: byte
        description: |
          Defines the custom data (YAML encoded at Base64) that will be executed upon VM launch.
        example: ""
      shutdownScript:
        type: string
        format: byte
        writeOnly: true
        example: "IyEvdXNyL2Jpbi9lbnYgYmFzaAoiR29vZGJ5ZSBvbGQgaW5zdGFuY2Ui"
        description: |
          Defines the shutdown script (encoded at Base64) to execute once the VM is detached.
      network:
        title: Network
        description: Defines the network profile to launch the VM.
        type: object
        required:
          - resourceGroupName
          - virtualNetworkName
          - networkInterfaces
        properties:
          resourceGroupName:
            title: Resource Group Name
            description: Defines the resource group name of the virtual network to launch the VM.
            type: string
            example: subnetResourceGroup
          virtualNetworkName:
            title: Virtual Network Name
            description: Defines the name of the virtual network to launch the VM.
            type: string
            example: vname
          networkInterfaces:
            title: Network Interfaces
            description: Defines the network interfaces to launch with the VM.
            type: array
            items:
              type: object
              required:
                - isPrimary
                - subnetName
              properties:
                isPrimary:
                  title: Is Primary Criteria
                  description: |
                    Defines the network interface to be the primary network interface.
                    * <a style=color:red>Must be true for only one of the items.</a>
                  type: boolean
                  example: true
                subnetName:
                  title: Subnet Name
                  description: Defines the subnet to create the specific network interface.
                  type: string
                  example: "testSubnet"
                assignPublicIp:
                  title: Assign Public IP
                  description: Determines if a Public IP should be assigned in this network interface.
                  type: boolean
                  example: true
                publicIpSku:
                  title: Public Ip Sku
                  description: |
                    Defines the type of public IP to assign the VM.
                    * <a style=color:red>Required if assignPublicIp=true.</a>
                  type: string
                  enum: [Standard, Basic]
                  example: "Standard"
                networkSecurityGroup:
                  title: Network Security Group
                  description: Defines the network security group to use with the VM.
                  type: object
                  required:
                    - name
                    - resourceGroupName
                  properties:
                    name:
                      title: Name
                      description: Defines the name of the network security group to use.
                      type: string
                      example: "test"
                    resourceGroupName:
                      title: Resource Group Name
                      description: Defines the resource group of the network security group.
                      type: string
                      example: "test"
                enableIPForwarding:
                  title: Enable IP Forwarding
                  description: Enables the IP forwarding feature on the network interface.
                  type: boolean
                  example: true
                privateIpAddresses:
                  type: array
                  description: |
                    Defines a pool of private IPs to launch the VM.
                    * A list of unique items of ip addresses.
                    * If none exist then a dynamic IP is used.
                  items:
                    type: string
                    example:
                      - "172.23.4.20"
                additionalIpConfigurations:
                  title: Additional IP Configurations
                  description: Defines a list of extra IPs to be dynamically allocated.
                  type: array
                  items:
                    type: object
                    required:
                      - privateIpAddressVersion
                      - name
                    properties:
                      name:
                        title: Name
                        description: |
                          Defines the name of the additional Ip Configuration.
                          * <a style=color:red>Must be unique across additionalIpConfigurations.</a>
                        type: string
                        example: "test"
                      privateIpAddressVersion:
                        title: Private IP Address Version
                        description: Defines the type of IP to allocate to the additional IP configuration.
                        type: string
                        enum: [IPv4, IPv6]
                        default: IPv4
                        example: "IPv4"
                publicIps:
                  description: Defined a pool of Public Ips (from Azure) the VM would be launched with, that will be associated to the network interface.
                  type: array
                  items:
                    type: object
                    required:
                      - resourceGroupName
                      - name
                    properties:
                      resourceGroupName:
                        description: Defines the resource group name of the public ip to use in the public ip pool.
                        type: string
                        example: "resourceGroup"
                      name:
                        description: Defines the name of the public ip to use in the public ip pool.
                        type: string
                        example: "name"
                applicationSecurityGroups:
                  description: Defines the Application Security Groups that will be associated to the primary ip configration of the network interface.
                  type: array
                  items:
                    type: object
                    required:
                      - resourceGroupName
                      - name
                    properties:
                      resourceGroupName:
                        description: Defines the resource group name of the Application Security Group.
                        type: string
                        example: "AsgResourceGroup"
                      name:
                        description: Defines the name of the Application Security Group.
                        type: string
                        example: "AsgName"
      login:
        type: object
        description: |
          Defines the login information for admin access to sign into the VM.
          * <a style=color:red>Password/SSH is required for Linux.</a>
        required:
          - userName
        properties:
          userName:
            type: string
            description: |
              Defines user name for admin access to VMs.\
              Login can be set:
              * for windows: compute.launchSpecification.login.password
              * for linux: compute.launchSpecification.login.sshPublicKey
              Just user name, without pwd or SSH key
            example: "spotinst"
          sshPublicKey:
            type: string
            description: |
              SSH for admin access to Linux VMs.\
              Optional for Linux.
            example: "ssh-rsa"
          password:
            type: string
            writeOnly: true
            description: |
              Password for admin access to Windows VMs.\
              Required for Windows.
      loadBalancersConfig:
        type: object
        description: |
          Configure a Load Balancer.
        properties:
          loadBalancers:
            type: array
            description: |
              Add a load balancer. For Azure Gateway, each Backend Pool is a separate load balancer.
            items:
              type: object
              required:
                - type
                - resourceGroupName
                - name
                - backendPoolNames
              properties:
                type:
                  type: string
                  description: |
                    The type of load balancer.
                  enum: [ loadBalancer, applicationGateway ]
                  example: "loadBalancer"
                resourceGroupName:
                  type: string
                  description: |
                    The Resource Group name of the Load Balancer.
                  example: "testResourceGroup"
                name:
                  type: string
                  description: |
                    Name of the Application Gateway/Load Balancer
                  example: "testLoadBalancer"
                loadBalancerSku:
                  type: string
                  description: |
                    * if type is LoadBalancer then possible values are:
                     * “Standard"
                     * Basic”
                    * if ApplicationGateway then possible values are:
                     * “Standard_Large”
                     * “Standard_Medium”
                     * “Standard_Small”
                     * “Standard_v2
                     * “WAF_Large”
                     * “WAF_Medium"
                     * “WAF_v2"
                  example: "Standard"
                backendPoolNames:
                  type: array
                  description: |
                    Name of the Backend Pool to register the Stateful Node VMs to.\
                    Each Backend Pool is a separate load balancer.\
                    Required if Type is APPLICATION_GATEWAY.
                  example:
                    - "testBackendPool1"
                    - "testBackendPool2"
      tags:
        type: array
        description: |
          Defines the tags (unique Key-Value pairs) to tag your Stateful Node resources.
        items:
          type: object
          properties:
            tagKey:
              type: string
              description: |
                Tag Key for Stateful Node resources.
                * Maximum length of 512 characters.
              example: "env"
            tagValue:
              type: string
              description: |
                Tag Value for Stateful Node resources.
                * Maximum length of 512 characters.
              example: "staging"
        max: 44
      managedServiceIdentities:
        type: array
        writeOnly: true
        description: |
          Defines a user-assigned managed identity to the Stateful Node's VM.
        items:
          type: object
          required:
            - name
            - resourceGroupName
          properties:
            name:
              type: string
              description: |
                Defines the name of the managed service identities.
              example: "mySI2"
            resourceGroupName:
              type: string
              description: |
                Defines the resource group of the managed service identities.
              example: "myResourceGroup"
      extensions:
        type: array
        description: |
          A list of objects for Azure extensions.
        items:
          type: object
          required:
            - name
            - type
            - publisher
            - apiVersion
            - minorVersionAutoUpgrade
          properties:
            name:
              type: string
              description: |
                Required on compute.launchSpecification.extensions object
              required: true
              example: "extensionName"
            type:
              type: string
              required: true
              description: |
                Required on compute.launchSpecification.extensions object
              example: "customScript"
            publisher:
              type: string
              description: |
                Required on compute.launchSpecification.extensions object
              required: true
              example: "Microsoft.Azure.Extensions"
            apiVersion:
              type: string
              description: |
                The API version of the extension. Required if extension specified.
              example: "2.0"
            minorVersionAutoUpgrade:
              type: boolean
              required: true
              description: |
                Required on compute.launchSpecification.extensions object
              example: true
            publicSettings:
              type: object
              description: |
                Object for public settings
            protectedSettings:
              type: object
              description: |
                Object for protected settings
      dataDisks:
        type: array
        description: |
          The definitions of data disks that will be created and attached to the stateful node's VM.
        items:
          type: object
          required:
            - sizeGB
            - lun
            - type
          properties:
            sizeGB:
              type: integer
              description: |
                The size of the data disk in GB, required if dataDisks is specified.
              minimum: 1
              maximum: 1023
              example: 1
            lun:
              type: integer
              description: |
                The LUN of the data disk.
              example: 1
            type:
              type: string
              description: |
                The type of the data disk.
              enum: [ Standard_LRS, Premium_LRS, StandardSSD_LRS, UltraSSD_LRS ]
              example: "Standard_LRS"
        min: 0
        max: 4
      osDisk:
        type: object
        description: |
          Specify OS disk specification other than default.
        required:
          - type
        properties:
          type:
            type: string
            description: |
              The type of the OS disk,
            enum: [ Standard_LRS, Premium_LRS, StandardSSD_LRS ]
            example: "Standard_LRS"
          sizeGB:
            type: integer
            description: |
              The size of the data disk in GB.
            minimum: 1
            maximum: 1023
            example: 30
      secrets:
        title: secrets
        type: array
        description: |
          Set of certificates that should be installed on the VM
        items:
          type: object
          required:
            - sourceVault
            - vaultCertificates
          properties:
            sourceVault:
              type: object
              description: |
                The key vault reference, contains the required certificates
              required:
                - resourceGroupName
                - name
              properties:
                resourceGroupName:
                  type: string
                  required: true
                  description: |
                    The resource group name of the key vault
                name:
                  type: string
                  required: true
                  description: |
                    The name of the key vault
            vaultCertificates:
              type: array
              required: true
              description: |
                The required certificate references
              items:
                type: object
                properties:
                  certificateUrl:
                    type: string
                    required: true
                    description: |
                      The URL of the certificate under the key vault
                  certificateStore:
                    type: string
                    required: true
                    description: |
                      The certificate store directory the VM. The directory is created in the LocalMachine account.
                      * This field is required only when using windows OS type
                      * This field must be ‘null’ when the OS type is Linux
      bootDiagnostics:
        type: object
        description:
          "Will enable boot diagnostics in Azure when a new VM is launched"
        properties:
          isEnabled:
            type: boolean
            required: true
            description:
              "Allows you to enable and disable the configuration of boot diagnostics at launch"
            example: true
          type:
            type: string
            required: true
            description: Defines the storage type on VM launch  in Azure.
            enum: [ managed, unmanaged ]
            example: managed
          storageUri:
            type: string
            description: |
              The storage URI that is used if a type is unmanaged.
              * The storage URI must follow the blob storage URI format (\"https://<blobstoragename>.blob.core.windows.net/\").
              * StorageUri is required if the type is unmanaged.
              * StorageUri must be ‘null’ in case the boot diagnostics type is managed.
            example: "https://example.blob.core.windows.net/"


